<!-- Tailwind CSSæ’ç‰ˆæ”¹é€² -->

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Keyword Stats</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen p-6">

<div class="max-w-5xl mx-auto space-y-8">

    <h1 class="text-3xl font-bold text-center">ğŸ“Š Keyword Stats</h1>

    <!-- Top 10 -->
    <div class="bg-gray-800 rounded-2xl shadow-lg p-6">
        <h2 class="text-xl font-semibold text-red-400 mb-4">ğŸ”¥ Top 10 é—œéµå­—</h2>
        <ul id="top10" class="space-y-2"></ul>
    </div>

    <!-- All keywords -->
    <div class="bg-gray-800 rounded-2xl shadow-lg p-6">
        <h2 class="text-xl font-semibold text-blue-400 mb-4">å…¨éƒ¨é—œéµå­—</h2>
        <ul id="all" class="space-y-1 max-h-[400px] overflow-y-auto pr-2"></ul>
    </div>

</div>

<script>
const top10El = document.getElementById('top10');
const allEl = document.getElementById('all');

const evt = new EventSource('http://192.168.0.102:3332/status/keyword');

evt.onmessage = (event) => {
    const msg = JSON.parse(event.data);
    console.log('Received Data Raw message:', event);
    console.log('Received message:', msg);
    
    if (msg.type === 'top10') {
        top10El.innerHTML = '';
        msg.data.forEach((item, index) => {
            const li = document.createElement('li');
            li.className =
                "flex justify-between items-center bg-gray-700/60 rounded-lg px-4 py-2 text-red-300 font-semibold";

            li.innerHTML = `
                <span class="truncate">${index + 1}. ${item.message}</span>
                <div class="flex items-center gap-2 ml-4">
                    <span class="text-red-400">${item.count}</span>
                    <button
                        class="copy-btn px-2 py-1 text-xs bg-red-500/80 hover:bg-red-500 text-white rounded"
                        data-text="${item.message}"
                    >
                        è¤‡è£½
                    </button>
                </div>
            `;

            top10El.appendChild(li);
        });
    }

    if (msg.type === 'all') {
        allEl.innerHTML = '';
        msg.data.forEach(item => {
            const li = document.createElement('li');
            li.className =
                "flex justify-between items-center bg-gray-700/40 rounded-md px-3 py-1 text-sm";

           li.innerHTML = `
                <span class="truncate">${item.message}</span>
                <div class="flex items-center gap-2 ml-4">
                    <span class="text-gray-300">${item.count}</span>
                    <button
                        class="copy-btn px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded"
                        data-text="${item.message}"
                    >
                        è¤‡è£½
                    </button>
                </div>
            `;

            allEl.appendChild(li);
        });
    }
};


function copyText(text) {
  if (navigator.clipboard) {
    navigator.clipboard.writeText(text).catch(() => fallbackCopy(text));
  } else {
    fallbackCopy(text);
  }
}

function fallbackCopy(text) {
    const textarea = document.createElement("textarea");
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
   
    try {
        document.execCommand("copy");
        console.log("å·²è¤‡è£½ (fallback)");
    } catch (err) {
        console.error("è¤‡è£½å¤±æ•—:", err);
    }
    document.body.removeChild(textarea);

}
document.addEventListener("click", async (e) => {
    if (e.target.classList.contains("copy-btn")) {
        const text = e.target.dataset.text;

        try {
            await navigator.clipboard.writeText(text);
            e.target.textContent = "å·²è¤‡è£½";
            setTimeout(() => (e.target.textContent = "è¤‡è£½"), 1000);
        } catch (err) {
            e.target.textContent = "å¤±æ•— Fallback";
            console.warn("Clipboard API failed, using fallback:", err);
            
            setTimeout(() => (e.target.textContent = "è¤‡è£½"), 1000);
            fallbackCopy(text); 

        }
    }
});


</script>

</body>
</html>
